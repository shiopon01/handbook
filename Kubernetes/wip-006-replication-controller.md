
# ReplicationController

## 概要

レプリケーションコントローラーは複数のポッドを生成・維持するコントローラーオブジェクトのひとつ。現在は次世代の機能としてレプリカセットが提供されているので、レプリケーションコントローラーはあまり使うべきではないかもしれない。

ポッドを単体で作成した場合でも自動的な再起動は行われるが、実運用上、ポッドを単一インスタンスで使っても旨味は少ない。単一ポッドの場合、例えばポッドの再起動時はポッドの処理が止まってしまうし、何かの情報を処理しきれなくなった場合も実質詰みだ。

そんなポッドを水平に複数インスタンス生成し、可用性をできるだけ高く保つための仕組みがレプリケーションコントローラーだ。


レプリケーションコントローラーでは、予め設定しておいた `レプリカ` の数だけポッドを起動する。ポッドのインスタンスがこのレプリカ数より多いと自動的に削除されて調整されるし、少ないとポッドが追加されて調整される。 `kubectl patch` などでポッドの数を変更した場合も同様で、変更時にポッドの数も調整される。

このような機能を実現するため、レプリケーションコントローラーはポッドを常に監視して生存確認を行うセルフヒーリング機能を持っている。（ポッドがどのノードで生成されるかは、生成時にKubernetesが決定する）

また、レプリケーションコントローラーはローリングアップデートもサポートしている。レプリケーションコントローラーが更新された時、Kubernetesは古いレプリケーションコントローラーから新しいレプリケーションコントローラーにポッドを1つずつ置き換えていくことでローリングアップデートを実現している。レプリカ数（ポッド数）が0になったレプリケーションコントローラーは削除される。（ `kubectl rolling-update` ）

## Kubernetes YAML

```yaml
apiVersion: v1
kind: ReplicationController
metadata:
  name: redis-master
spec:
  replicas: 3 # レプリカ数の指定 この数だけPod数を維持
  selector:
    app: redis
  template:
    metadata:
      labels:
        app: redis
    spec:
      containers:
        - name: redis-master
          image: redis:2.8.23
          ports:
            - containerPort: 6379
```