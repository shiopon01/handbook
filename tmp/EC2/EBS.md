# 以下メモ


# Amazon Elastic Block Store

Amazon EC2インスタンスに仮想外付けされる、永続的なブロックレベルのストレージサービス。
通常、EC2のストレージではこちらを用いる。

## ユースケース

- OSやDBなど、永続性が必要なデータの格納
- スナップショット取得が必要なデータ
- AZ/リージョンをまたいでコピーしたいデータ
- ランダムI/Oを頻繁に行う場合

## 特徴

- EC2を停止しても、データは永続する
- デフォルトでは、インスタンスの削除後も保持される
- サイズは1GB単位で1TBまで
- ひとつのEC2インスタンスで複数のEBSを使える
- バックアップからEBSを作成可能 (他のAZにも作成できる)
- 既に参照されているEBSを他のEC2インスタンスから参照することはできないが、他のEC2インスタンスに付け替える事は可能

## 仕組み

EBSはネットワーク接続型のストレージサービスであり、物理インターフェース上で動くハイパーバイザとはネットワーク上で接続される。ハイパーバイザに接続されたEBSは、ハイパーバイザ上で動くEC2インスタンス (OS) からSCSIデバイスとして認識される。

## 課金

- サイズ
- 期間
- IO

## 機能

### EBSスナップショット

- EBSボリュームの特定時点のスナップショットをS3に保存
- 2回目以降のスナップショットは差分のみS3に保存
- 差分の保存なので、スナップショットの世代管理が可能
- 安価に長期保存が可能
- スナップショットからいくつでもEBSボリューム作成・復元が可能 (AZを跨いでも可能)
- スナップショットは他アカウントと共有が可能
- EBSのサイズ変更も、スナップショット活用によって実現が可能

### Snapshot Copy

作成したSnapshotをコピーする機能。
Region内コピー、Region間コピーの両方を実現している。

## オプション

### Provisioned IOPS

- IOPS (I/O per Second) 数が指定できるEBS
- OSからは通常のEBSと同じように見える
- Root VolumeのEBSもPIOPSを利用可能
- 1ボリュームのIOPS値の指定は100～4000で1刻みが可能
- 申請にて制限解除可能で、最大20TB, 10,000IOPSまで指定できる
- Volume作成時に指定して作成可能だが、EC2の作成時に一緒に作成することも可能

EBS-Optimized Instanceを一緒に利用することが前提のオプション。

### EBS-Optimized Instance

- EC2とEBS間のネットワークを最適化 (専用のストレージエリアネットワークを利用)
- 確保される帯域は500Mbps～2000Mbps

Standard EBS使用時でも効果があるが、Provisioned IOPSと一緒に利用するとより効果が高い。組み合わせることで、I/O値の最適化が可能。


# Instance Storage

Amazon EC2物理筐体のローカルディスク。EC2終了時に中のデータは全て削除される。

## ユースケース

- 計算時の一時ファイルや、画像処理の一時データ、キャッシュファイル
- デプロイするアプリケーションコードの置き場
- 冗長化を自分で作り込む場合
- 大容量のデータを1インスタンスに格納する場合
- SSDのIO速度が必要な場合
- ログの一時保存場所として。一旦Instance Storageに吐いて、S3にアップロード

## 特徴

- EC2インスタンスタイプにより、サイズと個数、HDD/SSDが予め決まっている
- ローカルディスクのため、ネットワークの影響を受けにくい
- EBSより起動に時間がかかる
- 任意のファイルシステムが利用可能
- 様々な暗号化製品の利用が可能
- 冗長化機能や分散FSも利用可能

### 注意

- スナップショット機能が無い
- EBSのように別のEC2に付け替えができない
- EC2を終了するとデータが消える (これを利用するEC2からは停止のオプションが無くなる)
  - 再起動 (Reboot) ではデータは消えない。終了時のみ消える。

## 課金

Instance Storage自体は無料。支払う料金はEC2インスタンス分のみ。

# 参考

http://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/ComponentsAMIs.html#storage-for-the-root-device
